kiosk_mode:
  admin_settings:
    hide_header: false
    hide_sidebar: false
  hide_header: true
  hide_sidebar: true
views:
  - title: Tablet
    cards:
      - type: vertical-stack
        cards:
          - type: custom:digital-clock
            dateFormat: dd LLLL yyyy
            timeFormat: HH:mm
          - type: custom:clock-weather-card
            entity: weather.accuweather
            sun_entity: sun.sun
            temperature_sensor: sensor.outside_temperature
            humidity_sensor: sensor.outside_humidity
            weather_icon_type: fill
            animated_icon: true
            forecast_rows: 4
            locale: en-GB
            time_pattern: HH:mm
            time_format: 24
            date_pattern: ccc, d.MM.yyyy
            hide_today_section: false
            hide_forecast_section: false
            show_humidity: true
            hide_clock: true
            hide_date: true
            hourly_forecast: false
            use_browser_time: false
            time_zone: null
            show_decimal: true
            apparent_sensor: sensor.accuweather_realfeel_temperature
            aqi_sensor: sensor.home_air_quality_today
            card_mod:
              style: |
                ha-card {
                  #color: darkorange;
                  #background: none;
                  #border: none;
                  margin-top: -3px !important;
                  height: 255px !important;
                  padding: 0px;
                  .grow-img {
                    max-width: 150%;
                    max-height: 150%;
                }
                .card-content {
                  height: 100%;  /* Ensure content fills the card height */
                  transform: translateY(-22px);  /* Adjust content positioning */
                }
          - type: custom:hourly-weather
            entity: weather.openweathermap
            icons: true
            show_wind: barb-and-speed
            show_date: boundary
            show_precipitation_amounts: false
            show_precipitation_probability: true
            name: ' '
            label_spacing: '1'
            num_segments: '7'
            view_layout:
              position: main
            card_mod:
              style: |
                ha-card {
                  #color: darkorange;
                  #background: none;
                  #border: none;
                  margin-top: -3px !important;
                  height: 200px;
                  padding: 0px;
                }
                ha-card * {
                      #font-size: 11px !important;
                      margin-top: -20px !important;
                    }
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Conditions Today
            icon: mdi:thermometer
            show_last_changed: false
            card_layout: normal
            show_icon: false
            styles: |-
              .bubble-state {
                     font-size: 19px;
                     opacity: 1 !important;
                    # color: #fc6c05;
                     justify-content: center;
                     font-weight: bold;
                     text-align: center;
                 }
              .bubble-name {
                     text-align: center;
                     justify-content: center;
                 }
            show_state: true
            show_name: true
            entity: sensor.accuweather_condition_day_0
            scrolling_effect: true
            show_attribute: false
          - type: custom:bubble-card
            card_type: button
            button_type: state
            name: Conditions Tomorrow
            icon: mdi:thermometer
            show_last_changed: false
            card_layout: normal
            show_icon: false
            styles: |-
              .bubble-state {
                     font-size: 19px;
                     opacity: 1 !important;
                   #  color: #fc6c05;
                     justify-content: center;
                     font-weight: bold;
                     text-align: center;
                     white-space: nowrap !important;
                     scroll-behavior: smooth;
                 }
              .bubble-name {
                     text-align: center;
                     justify-content: center;
                 }
            show_state: true
            show_name: true
            entity: sensor.accuweather_condition_day_1
            scrolling_effect: true
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                button_type: state
                name: Air Quality
                icon: mdi:thermometer
                show_last_changed: false
                card_layout: normal
                show_icon: false
                styles: |-
                  .bubble-state {
                         font-size: 19px;
                         opacity: 1 !important;
                        # color: #fc6c05;
                         justify-content: center;
                         font-weight: bold;
                     }
                  .bubble-name {
                         text-align: center;
                         justify-content: center;
                     }
                show_state: true
                show_name: true
                entity: sensor.accuweather_air_quality_day_0
                scrolling_effect: true
                button_action:
                  tap_action:
                    action: navigate
                    navigation_path: /dashboard-tablet2/weather-tablet
              - type: custom:bubble-card
                card_type: button
                button_type: state
                name: Cloud Cover
                icon: mdi:thermometer
                show_last_changed: false
                card_layout: normal
                show_icon: false
                styles: |-
                  .bubble-state {
                         font-size: 19px;
                         opacity: 1 !important;
                        # color: #fc6c05;
                         justify-content: center;
                         font-weight: bold;
                     }
                  .bubble-name {
                         text-align: center;
                         justify-content: center;
                     }
                show_state: true
                show_name: true
                scrolling_effect: true
                entity: sensor.accuweather_cloud_cover
              - type: custom:bubble-card
                card_type: button
                button_type: state
                name: Pressure
                icon: mdi:thermometer
                show_last_changed: false
                card_layout: normal
                show_icon: false
                styles: |-
                  .bubble-state {
                         font-size: 19px;
                         opacity: 1 !important;
                       #  color: #fc6c05;
                         justify-content: center;
                         font-weight: bold;
                     }
                  .bubble-name {
                         text-align: center;
                         justify-content: center;
                     }
                show_state: true
                show_name: true
                scrolling_effect: true
                entity: sensor.accuweather_pressure_tendency
          - type: horizontal-stack
            cards:
              - type: custom:bubble-card
                card_type: button
                button_type: state
                name: Today
                icon: mdi:thermometer
                show_last_changed: false
                card_layout: normal
                show_icon: false
                styles: |-
                  .bubble-state {
                         font-size: 17px;
                         opacity: 1 !important;
                         #color: #fc6c05;
                         justify-content: center;
                         font-weight: bold;
                         white-space: nowrap !important;
                         text-align: center;
                     }
                  .bubble-name {
                         text-align: center;
                         justify-content: center;
                     }
                show_state: true
                show_name: true
                entity: sensor.solcast_pv_forecast_forecast_today
                scrolling_effect: false
                show_attribute: false
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.solcast_pv_forecast_forecast_tomorrow
                name: Tomorrow
                icon: mdi:thermometer
                show_last_changed: false
                card_layout: normal
                show_icon: false
                styles: |-
                  .bubble-state {
                         font-size: 17px;
                         opacity: 1 !important;
                         #color: #fc6c05;
                         justify-content: center;
                         font-weight: bold;
                         white-space: nowrap !important;
                         text-align: center;
                     }
                  .bubble-name {
                         text-align: center;
                         justify-content: center;
                     }
                show_state: true
                show_name: true
                scrolling_effect: false
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.solcast_pv_forecast_forecast_day_3
                name: Day 3
                icon: mdi:thermometer
                show_last_changed: false
                card_layout: normal
                show_icon: false
                styles: |-
                  .bubble-state {
                         font-size: 17px;
                         opacity: 1 !important;
                         #color: #fc6c05;
                         justify-content: center;
                         font-weight: bold;
                         white-space: nowrap !important;
                         text-align: center;
                     }
                  .bubble-name {
                         text-align: center;
                         justify-content: center;
                     }
                show_state: true
                show_name: true
                scrolling_effect: false
      - type: vertical-stack
        cards:
          - type: custom:swipe-card
            cards:
              - type: custom:sunsynk-power-flow-card
                cardstyle: full
                show_solar: true
                inverter:
                  modern: false
                  auto_scale: true
                  model: growatt
                  autarky: 'no'
                  three_phase: false
                battery:
                  energy: 9000
                  invert_power: true
                  shutdown_soc: 10
                  show_daily: true
                  auto_scale: true
                  show_absolute: false
                  full_capacity: 100
                  empty_capacity: 10
                  max_power: 3000
                  show_remaining_energy: true
                  linear_gradient: true
                  dynamic_colour: true
                  charge_colour:
                    - 0
                    - 255
                    - 17
                  colour:
                    - 222
                    - 107
                    - 0
                  animate: true
                solar:
                  show_daily: true
                  mppts: 2
                  pv1_name: Front
                  pv2_name: Rear
                  auto_scale: true
                  dynamic_colour: true
                  pv1_max_power: 1640
                  pv2_max_power: 1640
                  efficiency: 3
                  max_power: 3280
                  display_mode: 2
                load:
                  show_daily: true
                  auto_scale: true
                  dynamic_colour: true
                  dynamic_icon: true
                  load1_icon: mdi:washing-machine
                  load2_name: Fridge
                  load2_icon: mdi:fridge
                  load1_name: WM
                  show_aux: false
                  show_daily_aux: false
                  aux_type: ''
                  additional_loads: 0
                  load3_name: Dryer
                  load3_icon: mdi:tumble-dryer
                  load4_name: Dish
                  load4_icon: mdi:dishwasher
                  aux_load1_name: Dryer
                  aux_loads: 2
                  essential_name: ' '
                  aux_load1_icon: mdi:tumble-dryer
                  aux_load2_icon: mdi:dishwasher
                  aux_load2_name: Dishwaser
                  invert_load: false
                  path_threshold: 90
                grid:
                  show_daily_buy: true
                  show_daily_sell: true
                  show_nonessential: false
                  dynamic_colour: true
                  auto_scale: true
                  show_absolute: false
                entities:
                  use_timer_248: switch.sunsynk_toggle_system_timer
                  inverter_voltage_154: sensor.grid_voltage
                  load_frequency_192: sensor.grid_frequency
                  inverter_power_175: sensor.load_power
                  grid_connected_status_194: binary_sensor.sunsynk_grid_connected_status
                  day_battery_charge_70: sensor.battery_energy_in
                  day_battery_discharge_71: sensor.battery_energy_out_old
                  battery_voltage_183: sensor.battery_voltage
                  battery_soc_184: sensor.battery_state_of_charge
                  battery_power_190: sensor.battery_power
                  battery_current_191: sensor.battery_current
                  day_grid_import_76: sensor.grid_energy_in
                  day_grid_export_77: sensor.grid_energy_out_old
                  grid_ct_power_172: sensor.grid_power
                  day_load_energy_84: sensor.live_load_meter
                  essential_power: none
                  nonessential_power: none
                  pv1_power_186: sensor.pv_power_2
                  pv2_power_187: sensor.pv_power_1
                  pv1_voltage_109: sensor.pv_voltage_2
                  pv1_current_110: sensor.pv_current_2
                  pv2_voltage_111: sensor.pv_voltage_1
                  pv2_current_112: sensor.pv_current_1
                  essential_load2: sensor.fridge_power
                  essential_load1: sensor.washing_machine_power
                  essential_load3: sensor.tumble_dryer_power
                  essential_load4: sensor.dishwasher_power
                  inverter_current_164: sensor.load_current
                  grid_power_169: sensor.
                  aux_load1: sensor.tumble_dryer_power
                  aux_load2: sensor.dishwasher_power
                  aux_load2_extra: sensor.dishwasher_current
                  aux_load1_extra: sensor.tumble_dryer_current
                  essential_load1_extra: sensor.washing_machine_current_3
                  essential_load2_extra: sensor.fridge_current
                  battery_temp_182: sensor.battery_temperature
                  essential_load3_extra: sensor.tumble_dryer_current
                  essential_load4_extra: sensor.dishwasher_current
                  remaining_solar: sensor.solcast_pv_forecast_forecast_remaining_today
                  priority_load_243: select.growatt_sph_work_mode_priority
                  day_pv_energy_108: sensor.pv_energy
                panel_mode: true
                large_font: true
                show_battery: true
                show_grid: true
                decimal_places: 2
                dynamic_line_width: true
                max_line_width: 10
                card_mod:
                  style: |
                    ha-card {
                      margin-top: 0px !important;
                      height: 385px !important;
                      padding: 0px;
                      
                    }
                    .card-content {
                      height: 100%;  /* Ensure content fills the card height */
                      transform: translateY(-220px);  /* Adjust content positioning */
                    }
              - type: vertical-stack
                cards:
                  - type: horizontal-stack
                    cards:
                      - type: custom:mushroom-entity-card
                        name: Front
                        fill_container: false
                        layout: vertical
                        entity: sensor.front_pv_energy_day
                        icon: mdi:solar-power-variant
                        icon_color: '#FF6347'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #FF6347;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                      - type: custom:mushroom-entity-card
                        name: Rear
                        fill_container: false
                        primary_info: name
                        layout: vertical
                        entity: sensor.rear_pv_energy_day
                        icon: mdi:solar-power-variant
                        icon_color: '#DAA520'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #DAA520;
                              --card-secondary-overflow: true;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                      - type: custom:mushroom-entity-card
                        name: Total
                        fill_container: false
                        primary_info: name
                        entity: sensor.pv_energy
                        icon: mdi:sun-angle
                        icon_color: '#FFA500'
                        layout: vertical
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #FFA500;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                  - type: horizontal-stack
                    cards:
                      - type: custom:mushroom-entity-card
                        fill_container: false
                        layout: vertical
                        entity: sensor.load_energy
                        name: Load
                        icon: mdi:home-lightning-bolt
                        icon_color: '#6495ED'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #6495ED;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                      - type: custom:mushroom-entity-card
                        name: Battery In
                        fill_container: false
                        primary_info: name
                        layout: vertical
                        entity: sensor.battery_energy_in
                        icon: mdi:battery-charging-100
                        icon_color: '#228B22'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #228B22;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                      - type: custom:mushroom-entity-card
                        name: Battery Out
                        fill_container: false
                        primary_info: name
                        layout: vertical
                        entity: sensor.battery_energy_out_old
                        icon: mdi:battery-charging-low
                        icon_color: '#FF1493'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #FF1493;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              b#background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                    view_layout:
                      position: sidebar
                  - type: horizontal-stack
                    cards:
                      - type: custom:mushroom-entity-card
                        name: Gas
                        fill_container: false
                        primary_info: name
                        layout: vertical
                        entity: sensor.daily_gas
                        icon: mdi:fire
                        icon_color: '#0057E7'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #0057E7;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                      - type: custom:mushroom-entity-card
                        name: Grid In
                        fill_container: false
                        layout: vertical
                        entity: sensor.grid_energy_in
                        icon: mdi:transmission-tower-export
                        icon_color: '#FF4500'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #FF4500;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
                      - type: custom:mushroom-entity-card
                        name: Grid Out
                        fill_container: false
                        primary_info: name
                        layout: vertical
                        entity: sensor.grid_energy_out_old
                        icon: mdi:transmission-tower-import
                        icon_color: '#2E8B57'
                        card_mod:
                          style: |
                            ha-card {
                              --card-secondary-color: #2E8B57;
                              --card-secondary-font-weight: bold;
                              --card-secondary-font-size: 16px;
                              --card-primary-font-size: 15px;
                              #background: none;
                              #border: none;
                              width: 120px;
                              top: 50%; /* Move the card 50% down from the top */
                              left: 50%; /* Move the card 50% from the left */
                              transform: translate(-50%, -50%); /* Center the card */
                            }
          - type: custom:swipe-card
            cards:
              - type: thermostat
                entity: climate.downstairs
                name: Heating
                features: null
                show_current_as_primary: true
                card_mod:
                  style:
                    hui-card-features $ hui-climate-hvac-modes-card-feature $: |
                      ha-control-select {
                       --control-select-background: none;
                       --state-climate-off-color: #f5e2fe;   
                       --state-climate-heating-color: #f5e2fe;                             
                      }    
                    ha-state-control-climate-temperature:
                      $: >
                        #.icon-button {padding: 10px;}

                        #.label ha-svg-icon  { color: red !important; }

                        #.target-button { color: red !important; }

                        #.label:nth-of-type(1) { color: yellow !important; }

                        #.label:nth-of-type(2) { color: cyan !important;
                        }        

                        #.target-button:nth-of-type(1) { color: lime !important;
                        }

                        #.target-button:nth-of-type(2) { color: blue !important;
                        }

                        #.buttons ha-outlined-icon-button:nth-of-type(1) {

                        #--md-sys-color-outline:purple !important;}

                        #.buttons ha-outlined-icon-button:nth-of-type(2)

                        #{--md-sys-color-outline:lime !important; }
                    ha-state-control-climate-temperature$:
                      ha-control-circular-slider$: |
                        .high {stroke: red !important; opacity: 1 !important; 
                                }
                        .low {  stroke: blue !important;
                                opacity: 1 !important; 
                                }
                        .arc { #stroke-width: 15px !important;
                               stroke: #c684e3 !important;
                               }
                        .background {
                                stroke: #f5e2fe !important;
                                opacity: 0.5 !important; 
                                stroke-width: 18px !important;}
                    .: |
                      #.title {
                                #font-size: 14px !important;
                                #color: cyan !important;
                                #text-align: left !important;
                                #background: #262626 !important;
                                 }
                      ha-card {
                        #background: black !important;
                          }

                      ha-state-control-climate-temperature $: |
                      .label:nth-of-type(1) { color: transparent !important; }
              - type: horizontal-stack
                cards:
                  - type: custom:button-card
                    entity: person.gabor_bence_paroczi
                    aspect_ratio: 4/4
                    show_name: false
                    show_icon: false
                    styles:
                      card:
                        - padding: 4%
                        - background-image: >-
                            [[[if
                            (states["binary_sensor.a065_music_active"].state ==
                            "on") return 'url("/local/BenMusic2.png")'; else
                            return 'url("/local/Ben1.png")'; ]]]
                        - background-size: 90%
                        - background-repeat: no-repeat
                        - background-position: top center
                        - '--keep-background': 'true'
                      custom_fields:
                        location:
                          - position: absolute
                          - left: 4%
                          - top: 4%
                          - color: >-
                              [[[ if (states["person.gabor_bence_paroczi"].state
                              == "home")  return "#50A14F";
                                  if (states["person.gabor_bence_paroczi"].state == "Bence Work") return "#FFA500"; else
                                  return "#e45649"; ]]]
                        battery:
                          - align-self: right
                          - position: absolute
                          - right: 4%
                          - top: 4%
                          - color: >-
                              [[[ if (states["sensor.a065_battery_level"].state
                              <= 30) return "#e45649"; if
                              (states["sensor.a065_battery_level"].state <= 50)
                              return "#ffa229"; else return "#50A14F"; ]]]
                        ringer:
                          - align-self: right
                          - position: absolute
                          - left: 4%
                          - right: 25%
                          - top: 4%
                          - color: >-
                              [[[ if (states["sensor.a065_ringer_mode"].state ==
                              "silent") return "#e45649"; if
                              (states["sensor.a065_ringer_mode"].state ==
                              "vibrate") return "#FFA500"; else return
                              "#50A14F"; ]]]
                        bluetooth:
                          - align-self: right
                          - position: absolute
                          - left: 5%
                          - right: 85%
                          - bottom: 4%
                          - color: >-
                              [[[ if
                              (states["binary_sensor.a065_bluetooth_state"].state
                              == "on") return "#52adff"; else return "#e45649";
                              ]]]
                        charging:
                          - align-self: right
                          - position: absolute
                          - right: 5%
                          - bottom: 4%
                          - color: >-
                              [[[ if (states["sensor.a065_charger_type"].state
                              == "ac") return "#00ff00"; if
                              (states["sensor.a065_charger_type"].state ==
                              "wireless") return "#00ff00";  else return
                              "#e45649"; ]]]
                    custom_fields:
                      location: |
                        [[[
                               if (states["person.gabor_bence_paroczi"].state == "home")
                                 return `<ha-icon
                                   icon="mdi:home"
                                   style="width: 22px; height: 25px;">
                                   </ha-icon>`
                               if (states["person.gabor_bence_paroczi"].state == "Bence Work")
                                 return `<ha-icon
                                   icon="mdi:office-building"
                                   style="width: 22px; height: 25px;">
                                   </ha-icon>`
                               else 
                                 return `<ha-icon
                                   icon="mdi:home-export-outline"
                                   style="width: 22px; height: 25px;">
                                   </ha-icon>`
                             ]]]
                      battery: |
                        [[[
                          return `<ha-icon
                            icon="mdi:battery"
                            style="width: 20px; height: 20px;"></ha-icon
                            <span>${states['sensor.a065_battery_level'].state}%</span>`
                        ]]]
                      ringer: |
                        [[[
                          if (states["sensor.a065_ringer_mode"].state == "silent")
                            return `<ha-icon
                              icon="mdi:cellphone-off"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                          if (states["sensor.a065_ringer_mode"].state == "vibrate")
                            return `<ha-icon
                              icon="mdi:vibrate"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                          else 
                            return `<ha-icon
                              icon="mdi:cellphone"
                              style="width: 22px; height: 22px;">
                              </ha-icon>
                              <span> ${states['sensor.a065_volume_level_ringer'].state}</span>`
                        ]]]
                      bluetooth: |
                        [[[
                          if (states["binary_sensor.a065_bluetooth_state"].state == "on")
                            return `<ha-icon
                              icon="mdi:bluetooth"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                          else 
                            return `<ha-icon
                              icon="mdi:bluetooth-off"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                        ]]]
                      charging: |
                        [[[
                          if (states["sensor.a065_charger_type"].state == "ac")
                            return `<ha-icon
                              icon="mdi:power-plug"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                          if (states["sensor.a065_charger_type"].state == "wireless")
                            return `<ha-icon
                              icon="mdi:battery-charging-wireless"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`    
                          else 
                            return `<ha-icon
                              icon="mdi:battery-minus"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                        ]]]
                    view_layout:
                      position: sidebar
                  - type: custom:button-card
                    entity: person.ildiko_paroczi
                    aspect_ratio: 4/4
                    show_name: false
                    show_icon: false
                    styles:
                      card:
                        - padding: 4%
                        - background-image: >-
                            [[[if
                            (states["binary_sensor.lge_nx9_music_active_2"].state
                            == "on") return 'url("/local/IldiMusic3.png")'; else
                            return 'url("/local/Ildi2.png")'; ]]]
                        - background-size: 90%
                        - background-repeat: no-repeat
                        - background-position: top center
                        - '--keep-background': 'true'
                      custom_fields:
                        location:
                          - position: absolute
                          - left: 4%
                          - top: 4%
                          - color: >-
                              [[[ if (states["person.ildiko_paroczi"].state ==
                              "home")  return "#50A14F";
                                  if (states["person.ildiko_paroczi"].state == "Ildi Work") return "#FFA500"; else
                                  return "#e45649"; ]]]
                        battery:
                          - align-self: right
                          - position: absolute
                          - right: 4%
                          - top: 4%
                          - color: >-
                              [[[ if
                              (states["sensor.lge_nx9_battery_level_2"].state <=
                              30) return "#e45649"; if
                              (states["sensor.lge_nx9_battery_level_2"].state <=
                              50) return "#ffa229"; else return "#50A14F"; ]]]
                        ringer:
                          - align-self: right
                          - position: absolute
                          - left: 4%
                          - right: 25%
                          - top: 4%
                          - color: >-
                              [[[ if
                              (states["sensor.lge_nx9_ringer_mode_2"].state ==
                              "silent") return "#e45649"; if
                              (states["sensor.lge_nx9_ringer_mode_2"].state ==
                              "vibrate") return "#FFA500"; else return
                              "#50A14F"; ]]]
                        bluetooth:
                          - align-self: right
                          - position: absolute
                          - left: 5%
                          - right: 85%
                          - bottom: 4%
                          - color: >-
                              [[[ if
                              (states["binary_sensor.lge_nx9_bluetooth_state_2"].state
                              == "on") return "#52adff"; else return "#e45649";
                              ]]]
                    custom_fields:
                      location: |
                        [[[
                               if (states["person.ildiko_paroczi"].state == "home")
                                 return `<ha-icon
                                   icon="mdi:home"
                                   style="width: 22px; height: 25px;">
                                   </ha-icon>`
                               if (states["person.ildiko_paroczi"].state == "Ildi Work")
                                 return `<ha-icon
                                   icon="mdi:office-building"
                                   style="width: 22px; height: 25px;">
                                   </ha-icon>`
                               else 
                                 return `<ha-icon
                                   icon="mdi:home-export-outline"
                                   style="width: 22px; height: 25px;">
                                   </ha-icon>`
                             ]]]
                      battery: |
                        [[[
                          return `<ha-icon
                            icon="mdi:battery"
                            style="width: 20px; height: 20px;"></ha-icon
                            <span>${states['sensor.lge_nx9_battery_level_2'].state}%</span>`
                        ]]]
                      ringer: |
                        [[[
                          if (states["sensor.lge_nx9_ringer_mode_2"].state == "silent")
                            return `<ha-icon
                              icon="mdi:cellphone-off"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                          if (states["sensor.lge_nx9_ringer_mode_2"].state == "vibrate")
                            return `<ha-icon
                              icon="mdi:vibrate"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                          else 
                            return `<ha-icon
                              icon="mdi:cellphone"
                              style="width: 22px; height: 22px;">
                              </ha-icon>
                              <span> ${states['sensor.lge_nx9_volume_level_ringer_2'].state}</span>`
                        ]]]
                      bluetooth: |
                        [[[
                          if (states["binary_sensor.lge_nx9_bluetooth_state_2"].state == "on")
                            return `<ha-icon
                              icon="mdi:bluetooth"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                          else 
                            return `<ha-icon
                              icon="mdi:bluetooth-off"
                              style="width: 22px; height: 22px;">
                              </ha-icon>`
                        ]]]
              - type: horizontal-stack
                cards:
                  - type: custom:bar-card
                    entities:
                      - entity: sensor.utility_room_battery
                        name: Utility
                    direction: up
                    icon: none
                    height: 210px
                    stack: horizontal
                    severity:
                      - color: Red
                        from: '0'
                        to: '25'
                      - color: Orange
                        from: '26'
                        to: '50'
                      - color: Yellow
                        from: '51'
                        to: '75'
                      - color: Green
                        from: '76'
                        to: '100'
                    entity_row: true
                    card_mod:
                      style: |
                        bar-card-value {
                          color: black;
                          font-weight: bold;
                        }
                  - type: custom:bar-card
                    entities:
                      - entity: sensor.bedroom_battery
                        name: Bedroom
                    direction: up
                    icon: none
                    height: 110px
                    stack: horizontal
                    severity:
                      - color: Red
                        from: '0'
                        to: '25'
                      - color: Orange
                        from: '26'
                        to: '50'
                      - color: Yellow
                        from: '51'
                        to: '75'
                      - color: Green
                        from: '76'
                        to: '100'
                    entity_row: true
                    card_mod:
                      style: |
                        bar-card-value {
                          color: black;
                          font-weight: bold;
                        }
                  - type: custom:bar-card
                    entities:
                      - entity: sensor.bf9e08uiypoxrtai_battery
                        name: Bot
                    direction: up
                    icon: none
                    height: 110px
                    stack: horizontal
                    severity:
                      - color: Red
                        from: '0'
                        to: '25'
                      - color: Orange
                        from: '26'
                        to: '50'
                      - color: Yellow
                        from: '51'
                        to: '75'
                      - color: Green
                        from: '76'
                        to: '100'
                    entity_row: true
                    card_mod:
                      style: |
                        bar-card-value {
                          color: black;
                          font-weight: bold;
                        }
                  - type: custom:bar-card
                    entities:
                      - entity: sensor.lanyard_mini_hygrometer_0cab_battery
                        name: Loft
                    direction: up
                    icon: none
                    height: 110px
                    stack: horizontal
                    severity:
                      - color: Red
                        from: '0'
                        to: '25'
                      - color: Orange
                        from: '26'
                        to: '50'
                      - color: Yellow
                        from: '51'
                        to: '75'
                      - color: Green
                        from: '76'
                        to: '100'
                    entity_row: true
                    card_mod:
                      style: |
                        bar-card-value {
                          color: black;
                          font-weight: bold;
                        }
                  - type: custom:bar-card
                    entities:
                      - entity: sensor.solcast_pv_forecast_api_used
                        name: API
                    direction: up
                    icon: none
                    height: 110px
                    stack: horizontal
                    severity:
                      - color: Red
                        from: '17'
                        to: '20'
                      - color: Orange
                        from: '11'
                        to: '16'
                      - color: Yellow
                        from: '7'
                        to: '10'
                      - color: Green
                        from: '0'
                        to: '6'
                    entity_row: true
                    limit_value: true
                    max: 20
                    card_mod:
                      style: |
                        bar-card-value {
                          color: black;
                          font-weight: bold;
                        }
                  - type: custom:bar-card
                    entities:
                      - entity: sensor.sm_t500_battery_level
                        name: Tablet
                    direction: up
                    icon: none
                    height: 110px
                    stack: horizontal
                    severity:
                      - color: Red
                        from: '0'
                        to: '25'
                      - color: Orange
                        from: '26'
                        to: '50'
                      - color: Yellow
                        from: '51'
                        to: '75'
                      - color: Green
                        from: '76'
                        to: '100'
                    entity_row: true
                    card_mod:
                      style: |
                        bar-card-value {
                          color: black;
                          font-weight: bold;
                        }
      - type: vertical-stack
        cards:
          - type: horizontal-stack
            cards:
              - type: custom:energy-overview-card
                entities:
                  - power: sensor.fridge_power
                    name: Fridge
                    voltage: sensor.fridge_voltage
                    current: sensor.fridge_current
                    icon_leading: mdi:power-socket-uk
                    icon_trailing: mdi:fridge
                    color: Blue
                    animation:
                      power: 3000
                  - power: sensor.washing_machine_power
                    voltage: sensor.washing_machine_voltage_3
                    current: sensor.washing_machine_current_3
                    name: Washing Machine
                    icon_leading: mdi:power-socket-uk
                    icon_trailing: mdi:washing-machine
                    color: green
                    animation:
                      power: 3000
                  - power: sensor.tumble_dryer_power
                    voltage: sensor.tumble_dryer_voltage
                    current: sensor.tumble_dryer_current
                    name: Tumble Dryer
                    icon_leading: mdi:power-socket-uk
                    icon_trailing: mdi:tumble-dryer
                    color: Red
                    animation:
                      power: 3000
                card_mod:
                  style: |
                    ha-card {
                     .line svg {
                      width: 120%;
                      height: 14px;
                    }
                     .line {
                      flex: 1;
                      height: 10px;
                      box-sizing: border-box;
                      margin: 18px;

                    }
                    }
              - type: custom:energy-overview-card
                entities:
                  - power: sensor.dishwasher_power
                    voltage: sensor.dishwasher_voltage
                    current: sensor.dishwasher_current
                    name: Dishwasher
                    icon_leading: mdi:power-socket-uk
                    icon_trailing: mdi:dishwasher
                    color: Orange
                  - power: sensor.water_filter_power_2
                    voltage: sensor.water_filter_voltage_2
                    current: sensor.water_filter_current
                    name: Water Filter
                    icon_leading: mdi:power-socket-uk
                    icon_trailing: mdi:water-pump
                    color: Aqua
                    animation:
                      power: 3000
                  - power: sensor.antela_smart_plug_uk_power
                    voltage: sensor.antela_smart_plug_uk_voltage
                    current: sensor.antela_smart_plug_uk_current
                    name: Tablet
                    icon_leading: mdi:power-socket-uk
                    icon_trailing: mdi:tablet-dashboard
                    color: White
                    animation:
                      power: 3000
                card_mod:
                  style: |
                    ha-card {
                     .line svg {
                      width: 120%;
                      height: 14px;
                    }
                     .line {
                      flex: 1;
                      height: 10px;
                      box-sizing: border-box;
                      margin: 18px;

                    }
                    }
          - type: horizontal-stack
            cards:
              - type: custom:slider-button-card
                entity: switch.patio_lights
                slider:
                  direction: left-right
                  background: gradient
                  use_state_color: false
                  use_percentage_bg_opacity: false
                  show_track: false
                  toggle_on_click: true
                  force_square: false
                  show_attribute: false
                show_name: true
                show_state: true
                compact: false
                icon:
                  show: true
                  use_state_color: true
                  tap_action:
                    action: more-info
                  icon: mdi:lightbulb-group
                action_button:
                  mode: toggle
                  icon: mdi:power
                  show: true
                  show_spinner: true
                  tap_action:
                    action: toggle
                attribute: voltage
                name: Patio
                show_attribute: false
              - type: custom:slider-button-card
                entity: light.kitchen_lights
                slider:
                  direction: left-right
                  background: gradient
                  use_state_color: true
                  use_percentage_bg_opacity: true
                  show_track: true
                  toggle_on_click: false
                  force_square: false
                  show_attribute: false
                show_name: true
                show_state: true
                compact: false
                icon:
                  show: true
                  use_state_color: true
                  tap_action:
                    action: more-info
                  icon: mdi:ceiling-light-multiple
                action_button:
                  mode: toggle
                  icon: mdi:power
                  show: true
                  show_spinner: true
                  tap_action:
                    action: toggle
                attribute: brightness
                name: Kitchen
                show_attribute: false
          - type: vertical-stack
            cards:
              - type: horizontal-stack
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    name: Heating On Today
                    icon: mdi:thermometer
                    show_last_changed: false
                    card_layout: large
                    show_icon: false
                    styles: |-
                      .bubble-state {
                             font-size: 20px;
                             opacity: 1 !important;
                             #color: #fc6c05;
                             justify-content: center;
                             font-weight: bold;
                         }
                      .bubble-name {
                             text-align: center;
                             justify-content: center;
                         }
                    show_state: true
                    show_name: true
                    entity: sensor.heating_time_in_hours_and_minutes
                  - type: custom:slider-button-card
                    entity: switch.turkish_lamp
                    slider:
                      direction: left-right
                      background: gradient
                      use_state_color: false
                      use_percentage_bg_opacity: false
                      show_track: false
                      toggle_on_click: true
                      force_square: false
                      show_attribute: false
                    show_name: true
                    show_state: true
                    compact: true
                    icon:
                      show: true
                      use_state_color: true
                      tap_action:
                        action: more-info
                      icon: mdi:floor-lamp
                    action_button:
                      mode: toggle
                      icon: mdi:power
                      show: true
                      show_spinner: true
                      tap_action:
                        action: toggle
                    name: Lamp
                    show_attribute: false
              - type: horizontal-stack
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: sensor.lanyard_mini_hygrometer_0cab_temperature
                    name: Loft
                    icon: mdi:thermometer
                    show_last_changed: false
                    card_layout: normal
                    show_icon: false
                    styles: |-
                      .bubble-state {
                             font-size: 20px;
                             opacity: 1 !important;
                             #color: #fc6c05;
                             justify-content: center;
                             font-weight: bold;
                         }
                      .bubble-name {
                             text-align: center;
                             justify-content: center;
                         }
                    show_state: true
                    show_name: true
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    name: Battery
                    icon: mdi:thermometer
                    show_last_changed: false
                    card_layout: normal
                    show_icon: false
                    styles: |-
                      .bubble-state {
                             font-size: 20px;
                             opacity: 1 !important;
                             #color: #fc6c05;
                             justify-content: center;
                             font-weight: bold;
                         }
                      .bubble-name {
                             text-align: center;
                             justify-content: center;
                         }
                    show_state: true
                    show_name: true
                    entity: sensor.battery_temperature
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    name: Inverter
                    icon: mdi:thermometer
                    show_last_changed: false
                    card_layout: normal
                    show_icon: false
                    styles: |-
                      .bubble-state {
                             font-size: 20px;
                             opacity: 1 !important;
                             #color: #fc6c05;
                             justify-content: center;
                             font-weight: bold;
                         }
                      .bubble-name {
                             text-align: center;
                             justify-content: center;
                         }
                    show_state: true
                    show_name: true
                    entity: sensor.temperature
                view_layout:
                  position: sidebar
              - type: horizontal-stack
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    name: Utility
                    icon: mdi:thermometer
                    show_last_changed: false
                    card_layout: normal
                    show_icon: false
                    styles: |-
                      .bubble-state {
                             font-size: 20px;
                             opacity: 1 !important;
                             color: ${hass.states['sensor.downstairs_hvac_action'].state === 'heating' ? 'black' : ''} !important;
                             justify-content: center;
                             font-weight: bold;
                         }
                      .bubble-name {
                             text-align: center;
                             justify-content: center;
                         }
                      .bubble-button-background {
                             opacity: 1 !important;
                             background-color: ${hass.states['sensor.downstairs_hvac_action'].state === 'heating' ? '#c684e3' : 'none'} !important;
                      }   
                      .bubble-button-card-container {
                            position: relative;
                            width: 100%;
                            height: 50px;
                        }    
                    show_state: true
                    show_name: true
                    entity: sensor.utility_room_temperature
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    name: Upstairs
                    icon: mdi:thermometer
                    show_last_changed: false
                    card_layout: normal
                    show_icon: false
                    styles: |-
                      .bubble-state {
                             font-size: 20px;
                             opacity: 1 !important;
                             color: ${hass.states['sensor.downstairs_hvac_action'].state === 'heating' ? 'black' : ''} !important;
                             justify-content: center;
                             font-weight: bold;
                         }
                      .bubble-name {
                             text-align: center;
                             justify-content: center;
                         }
                      .bubble-button-background {
                             opacity: 1 !important;
                             background-color: ${hass.states['sensor.downstairs_hvac_action'].state === 'heating' ? '#c684e3' : 'none'} !important;
                      }   
                      .bubble-button-card-container {
                            position: relative;
                            width: 100%;
                            height: 50px;
                        }    
                    show_state: true
                    show_name: true
                    entity: sensor.bedroom_temperature
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    name: Livingroom
                    icon: mdi:thermometer
                    show_last_changed: false
                    card_layout: normal
                    show_icon: false
                    styles: |-
                      .bubble-state {
                             font-size: 20px;
                             opacity: 1 !important;
                             color: ${hass.states['sensor.downstairs_hvac_action'].state === 'heating' ? 'black' : ''} !important;
                             justify-content: center;
                             font-weight: bold;
                             overflow: visible !important;
                             white-space: nowrap !important;
                         }
                      .bubble-name {
                             text-align: center;
                             justify-content: center;
                         }
                      .bubble-button-background {
                             opacity: 1 !important;
                             background-color: ${hass.states['sensor.downstairs_hvac_action'].state === 'heating' ? '#c684e3' : 'none'} !important;
                      }
                      .bubble-button-card-container {
                            position: relative;
                            width: 100%;
                            height: 50px;
                        }    
                    show_state: false
                    show_name: true
                    entity: climate.downstairs
                    show_attribute: true
                    force_icon: false
                    attribute: current_temperature
                    button_action:
                      tap_action:
                        action: more-info
                    scrolling_effect: true
                view_layout:
                  position: sidebar
              - type: horizontal-stack
                cards:
                  - type: custom:mushroom-entity-card
                    entity: sensor.lanyard_mini_hygrometer_0cab_temperature
                    name: Energy
                    icon: mdi:home-lightning-bolt
                    fill_container: true
                    layout: vertical
                    tap_action:
                      action: navigate
                      navigation_path: /dashboard-tablet2/1
                    secondary_info: none
                    icon_color: blue
                    card_mod:
                      style: |
                        ha-card {
                          #background: none;
                          #border: none;
                          width: 100px;
                          top: 50%; /* Move the card 50% down from the top */
                          left: 50%; /* Move the card 50% from the left */
                          transform: translate(-50%, -50%); /* Center the card */
                        }
                  - type: custom:mushroom-entity-card
                    icon: mdi:solar-power-variant
                    fill_container: true
                    layout: vertical
                    tap_action:
                      action: navigate
                      navigation_path: /dashboard-tablet2/sunsynk
                    secondary_info: none
                    name: Power
                    entity: sensor.lanyard_mini_hygrometer_0cab_temperature
                    icon_color: accent
                    card_mod:
                      style: |
                        ha-card {
                          #background: none;
                          #border: none;
                          width: 100px;
                          top: 50%; /* Move the card 50% down from the top */
                          left: 50%; /* Move the card 50% from the left */
                          transform: translate(-50%, -50%); /* Center the card */
                        }
                        }
                  - type: custom:mushroom-entity-card
                    fill_container: false
                    layout: vertical
                    tap_action:
                      action: navigate
                      navigation_path: /dashboard-tablet2/low-carbon-info
                    name: Grid CO2
                    secondary_info: none
                    icon: mdi:molecule-co2
                    hold_action:
                      action: none
                    double_tap_action:
                      action: none
                    entity: sensor.lanyard_mini_hygrometer_0cab_temperature
                    icon_color: green
                    card_mod:
                      style: |
                        ha-card {
                          #--card-secondary-color: darkorange;
                          #--card-secondary-font-weight: bold;
                          #--card-secondary-font-size: 20px;
                          #--card-primary-font-size: 15px;
                          #background: none;
                          #border: none;
                          width: 100px;
                          top: 50%; /* Move the card 50% down from the top */
                          left: 50%; /* Move the card 50% from the left */
                          transform: translate(-50%, -50%); /* Center the card */
                        }
                  - type: custom:mushroom-entity-card
                    fill_container: false
                    layout: vertical
                    tap_action:
                      action: navigate
                      navigation_path: /dashboard-tablet2/Controls
                    name: Energy 2
                    secondary_info: none
                    icon: mdi:home-lightning-bolt-outline
                    hold_action:
                      action: none
                    double_tap_action:
                      action: none
                    entity: sensor.lanyard_mini_hygrometer_0cab_temperature
                    icon_color: deep-purple
                    card_mod:
                      style: |
                        ha-card {
                          #--card-secondary-color: darkorange;
                          #--card-secondary-font-weight: bold;
                          #--card-secondary-font-size: 20px;
                          #--card-primary-font-size: 15px;
                          #background: none;
                          #border: none;
                          width: 100px;
                          top: 50%; /* Move the card 50% down from the top */
                          left: 50%; /* Move the card 50% from the left */
                          transform: translate(-50%, -50%); /* Center the card */
                        }
              - type: horizontal-stack
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: switch
                    show_state: true
                    show_last_changed: false
                    show_attribute: true
                    attribute: brightness
                    tap_action:
                      action: toggle
                    card_layout: large
                    columns: 2
                    rows: 2
                    icon: mdi:dishwasher
                    styles: |-
                      .bubble-button-background {
                          opacity: 1 !important;
                          background-color: ${state === 'on' ? '#c684e3' : 'none'} !important;
                        }
                    entity: automation.dishwasher_off_peak_start
                    name: Dishwasher
                    card_mod:
                      style: |
                        ha-card {
                          #margin-top: -13px !important;
                  - type: custom:bubble-card
                    card_type: button
                    button_type: switch
                    show_state: true
                    show_last_changed: false
                    show_attribute: true
                    attribute: brightness
                    tap_action:
                      action: toggle
                    card_layout: large
                    columns: 2
                    rows: 2
                    icon: mdi:transmission-tower-export
                    styles: |-
                      .bubble-button-background {
                          opacity: 1 !important;
                          background-color: ${state === 'on' ? '#c684e3' : 'none'} !important;
                        }
                    entity: automation.grid_charge_on
                    name: Grid Charge
                    card_mod:
                      style: |
                        ha-card {
                          #margin-top: -13px !important;
          - type: custom:mini-media-player
            entity: media_player.ytube_music_player
            artwork: material
            info: scroll
    icon: mdi:tablet-dashboard
    type: custom:horizontal-layout
  - kiosk_mode:
      hide_header: false
    title: Energy Tablet
    subview: true
    icon: mdi:home-lightning-bolt
    type: sidebar
    cards:
      - type: custom:mushroom-entity-card
        entity: sensor.lanyard_mini_hygrometer_0cab_temperature
        name: Back to Dasboard
        fill_container: true
        icon_type: none
        layout: vertical
        secondary_info: none
        tap_action:
          action: navigate
          navigation_path: /dashboard-tablet2
        card_mod:
          style: |
            ha-card {
              --card-primary-color: darkorange;
              --card-secondary-font-weight: bold;
              --card-secondary-font-size: 20px;
              --card-primary-font-size: 15px;
              background: none;
              border: none;
            }
        view_layout:
          position: sidebar
      - type: energy-distribution
        view_layout:
          position: sidebar
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - type: energy-date-selection
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - type: energy-usage-graph
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - type: energy-devices-detail-graph
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - type: energy-solar-graph
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - layout: horizontal
        height: 200
        unit_prefix: k
        round: 2
        convert_units_to: ''
        co2_intensity_entity: sensor.co2_signal_co2_intensity
        gas_co2_intensity: 2351.6459999999997
        min_box_size: 3
        min_box_distance: 5
        show_states: true
        show_units: true
        sections:
          - entities:
              - type: entity
                children:
                  - sensor.pv_energy
                entity_id: sensor.front_pv_energy_day
                icon: mdi:solar-power
                color: Orange
                name: Front
              - type: entity
                children:
                  - sensor.pv_energy
                entity_id: sensor.rear_pv_energy_day
                name: Rear
                icon: mdi:solar-power
                color: Orange
          - entities:
              - type: remaining_child_state
                children:
                  - sensor.self_consumed_solar_energy_day
                  - sensor.solar_battery_charge_day
                  - sensor.solar_grid_return_day
                entity_id: sensor.pv_energy
                icon: mdi:solar-power
                name: Total Solar
                color: Orange
          - entities:
              - type: entity
                children: []
                entity_id: sensor.self_consumed_solar_energy_day
                color: Yellow
                icon: mdi:home-lightning-bolt
                name: Consumed Solar
              - type: entity
                children: []
                entity_id: sensor.solar_battery_charge_day
                color: green
                icon: mdi:battery-plus-variant
                name: Solar Battery Charge
              - type: entity
                children: []
                entity_id: sensor.solar_grid_return_day
                color: Purple
                icon: mdi:transmission-tower-import
                name: Returned to Grid
          - entities: []
        min_box_height: 15
        type: custom:sankey-chart
        min_state: 0
        show_names: true
        show_icons: true
        energy_date_selection: true
        wide: true
        view_layout:
          position: main
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - type: energy-gas-graph
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - type: energy-sources-table
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
              --ha-card-background: transparent;
              border-style: none;
      - layout: horizontal
        height: 200
        unit_prefix: k
        round: 2
        convert_units_to: ''
        co2_intensity_entity: sensor.co2_signal_co2_intensity
        gas_co2_intensity: 2351.6459999999997
        min_box_size: 13
        min_box_distance: 5
        show_states: true
        show_units: true
        sections:
          - entities:
              - type: entity
                children:
                  - sensor.washing_machine_new
                  - sensor.dishwasher_new
                  - sensor.fridge_new
                  - sensor.tumble_dryer_new
                  - sensor.water_filter_energy_day
                  - sensor.display_charge_energy_day
                  - sensor.wallbox_pulsar_max_sn_957826_added_energy
                entity_id: sensor.load_energy
                icon: mdi:home-lightning-bolt
                name: House Load
                color: Aqua
          - entities:
              - type: entity
                children: []
                entity_id: sensor.washing_machine_new
                color: Green
                name: Washing Machine
              - type: entity
                children: []
                entity_id: sensor.fridge_new
                color: Aqua
                name: Fridge
              - type: entity
                children: []
                entity_id: sensor.tumble_dryer_new
                color: Red
                name: Tumble Dryer
              - type: entity
                children: []
                entity_id: sensor.dishwasher_new
                color: Blue
                name: Dishwasher
              - type: entity
                children: []
                entity_id: sensor.water_filter_energy_day
                name: Water Filter
                icon: mdi:water-pump
              - type: entity
                children: []
                entity_id: sensor.display_charge_energy_day
                name: Display Charger
                color: White
              - sensor.wallbox_pulsar_max_sn_957826_added_energy
        min_box_height: 15
        type: custom:sankey-chart
        min_state: 0
        show_names: true
        show_icons: true
        energy_date_selection: true
        wide: true
        view_layout:
          position: sidebar
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - type: energy-self-sufficiency-gauge
        view_layout:
          position: sidebar
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
      - layout: vertical
        height: 200
        unit_prefix: ''
        round: 2
        convert_units_to: ''
        min_box_size: 3
        min_box_distance: 5
        show_states: true
        show_units: true
        sections:
          - entities:
              - type: entity
                children: []
                entity_id: sensor.heating_day
                icon: mdi:water-boiler
                name: Heating On
                color: red
          - entities: []
        type: custom:sankey-chart
        min_state: 0
        show_names: true
        show_icons: true
        energy_date_selection: true
        static_scale: -1
        throttle: 0
        wide: true
        view_layout:
          position: sidebar
        card_mod:
          style: |
            ha-card {
              color: darkorange;
              background: none;
              border: none;
  - title: Sunsynk
    path: sunsynk
    icon: mdi:solar-power-variant
    subview: true
    cards:
      - type: custom:button-card
        show_state: false
        show_name: false
        show_icon: false
        tap_action:
          action: none
        custom_fields:
          sunsynk:
            card:
              type: custom:sunsynk-power-flow-card
              cardstyle: full
              show_solar: true
              inverter:
                modern: false
                auto_scale: true
                model: growatt
                autarky: 'no'
                three_phase: false
              battery:
                energy: 9000
                invert_power: true
                shutdown_soc: 10
                show_daily: true
                auto_scale: true
                show_absolute: false
                full_capacity: 100
                empty_capacity: 10
                max_power: 3000
                show_remaining_energy: true
                linear_gradient: true
                dynamic_colour: true
                charge_colour:
                  - 0
                  - 255
                  - 17
                colour:
                  - 222
                  - 107
                  - 0
                animate: true
              solar:
                show_daily: true
                mppts: 2
                pv1_name: Front
                pv2_name: Rear
                auto_scale: true
                dynamic_colour: true
                pv1_max_power: 1640
                pv2_max_power: 1640
                efficiency: 3
                max_power: 3280
                display_mode: 2
              load:
                show_daily: true
                auto_scale: true
                dynamic_colour: true
                dynamic_icon: true
                load1_icon: mdi:washing-machine
                load2_name: Fridge
                load2_icon: mdi:fridge
                load1_name: WM
                show_aux: false
                show_daily_aux: false
                aux_type: ''
                additional_loads: 4
                load3_name: Dryer
                load3_icon: mdi:tumble-dryer
                load4_name: Dish
                load4_icon: mdi:dishwasher
                aux_load1_name: Dryer
                aux_loads: 2
                essential_name: ' '
                aux_load1_icon: mdi:tumble-dryer
                aux_load2_icon: mdi:dishwasher
                aux_load2_name: Dishwaser
                invert_load: false
                path_threshold: 90
              grid:
                show_daily_buy: true
                show_daily_sell: true
                show_nonessential: false
                dynamic_colour: true
                auto_scale: true
                show_absolute: false
              entities:
                use_timer_248: switch.sunsynk_toggle_system_timer
                priority_load_243: switch.sunsynk_toggle_priority_load
                inverter_voltage_154: sensor.grid_voltage
                load_frequency_192: sensor.grid_frequency
                inverter_power_175: sensor.load_power
                grid_connected_status_194: binary_sensor.sunsynk_grid_connected_status
                day_battery_charge_70: sensor.battery_energy_in
                day_battery_discharge_71: sensor.battery_energy_out_old
                battery_voltage_183: sensor.battery_voltage
                battery_soc_184: sensor.battery_state_of_charge
                battery_power_190: sensor.battery_power
                battery_current_191: sensor.battery_current
                day_grid_import_76: sensor.grid_energy_in
                day_grid_export_77: sensor.grid_energy_out_old
                grid_ct_power_172: sensor.grid_power
                day_load_energy_84: sensor.live_load_meter
                essential_power: none
                nonessential_power: none
                day_pv_energy_108: sensor.pv_energy
                pv1_power_186: sensor.pv_power_2
                pv2_power_187: sensor.pv_power_1
                pv1_voltage_109: sensor.pv_voltage_2
                pv1_current_110: sensor.pv_current_2
                pv2_voltage_111: sensor.pv_voltage_1
                pv2_current_112: sensor.pv_current_1
                essential_load2: sensor.fridge_power
                essential_load1: sensor.washing_machine_power
                essential_load3: sensor.tumble_dryer_power
                essential_load4: sensor.dishwasher_power
                inverter_status_59: select.growatt_sph_work_mode_priority
                remaining_solar: sensor.solcast_pv_forecast_forecast_remaining_today
                inverter_current_164: sensor.load_current
                grid_power_169: sensor.
                aux_load1: sensor.tumble_dryer_power
                aux_load2: sensor.dishwasher_power
                aux_load2_extra: sensor.dishwasher_current
                aux_load1_extra: sensor.tumble_dryer_current
                essential_load1_extra: sensor.washing_machine_current_3
                essential_load2_extra: sensor.fridge_current
                battery_temp_182: sensor.battery_temperature
                essential_load3_extra: sensor.tumble_dryer_current
                essential_load4_extra: sensor.dishwasher_current
              panel_mode: true
              large_font: true
              show_battery: true
              show_grid: true
              decimal_places: 2
              dynamic_line_width: true
              max_line_width: 10
              card_mod:
                style: |
                  ha-card { 
                    --ha-card-background: transparent;
                    border-style: none;
                  }
          back:
            card:
              type: custom:mushroom-entity-card
              entity: sensor.lanyard_mini_hygrometer_0cab_temperature
              name: Back to Dasboard
              fill_container: true
              icon_type: none
              layout: vertical
              secondary_info: none
              tap_action:
                action: navigate
                navigation_path: /dashboard-tablet2
              card_mod:
                style: |
                  ha-card {
                    --card-primary-color: darkorange;
                    --card-secondary-font-weight: bold;
                    --card-secondary-font-size: 20px;
                    --card-primary-font-size: 25px;
                    background: none;
                  }
        styles:
          card:
            - padding: 4%
            - align_self: start
            - width: 1340px
            - height: 800px
            - opacity: 1
            - background-color: black
          custom_fields:
            sunsynk:
              - position: absolute
              - top: 0px
              - left: 50%
              - transform: translateX(-50%)
              - width: 945px
            back:
              - position: absolute
              - top: 10px
              - left: 60%
              - transform: translateX(-50%)
              - height: 40px
    type: panel
  - kiosk_mode:
      hide_header: false
    subview: true
    title: Controls
    path: Controls
    cards:
      - type: custom:mushroom-entity-card
        entity: sensor.lanyard_mini_hygrometer_0cab_temperature
        name: Back to Dasboard
        fill_container: true
        icon_type: none
        layout: vertical
        secondary_info: none
        tap_action:
          action: navigate
          navigation_path: /dashboard-tablet2
        card_mod:
          style: |
            ha-card {
              --card-primary-color: darkorange;
              --card-secondary-font-weight: bold;
              --card-secondary-font-size: 20px;
              --card-primary-font-size: 15px;
              background: none;
              border: none;
            }
        view_layout:
          position: sidebar
      - type: custom:plotly-graph
        view_layout:
          grid-area: graph
        entities:
          - entity: sensor.pv_power
            name: |
              $fn ({ ys,meta }) =>
                "Solar" + "🔆" + "(" +ys[ys.length - 1]+"W)"
            fill: tozeroy
            line:
              color: rgb(255, 155, 48)
              shape: spline
          - entity: sensor.load_power
            name: |
              $fn ({ ys,meta }) =>
                "Load" + "⚡" + "(" +ys[ys.length - 1]+"W)"
            fill: tozeroy
            line:
              color: rgb(95, 182, 173)
              shape: spline
          - entity: sensor.grid_power
            name: |
              $fn ({ ys,meta }) =>
                "Grid" + "💡" + "(" +ys[ys.length - 1]+"W)"
            fill: tozeroy
            line:
              color: rgb(84, 144, 194)
              shape: spline
            filters:
              - sliding_window_moving_average:
                  window_size: 1
                  extended: true
        hours_to_show: 24
        refresh_interval: 60
        title: Charts
        defaults:
          entity:
            show_value: false
          yaxes:
            fixedrange: true
        fn: |
          $fn({getFromConfig, vars})=> {
            const range = getFromConfig("visible_range");
            const width = range[1] - range[0];
            vars.scroll = (label, p) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [range[0] + width*p, range[1] + width*p],
                  }
                }, {
                  transition: {
                    duration: 150,
                  }
                }
              ],
              label,
              method: "animate",
            })
            vars.zoom = (label, h) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [Date.now()-1000*60*60*h, Date.now()],
                  }
                }
              ],
              label,
              method: "animate",
            })
          }
        layout:
          height: 500
          updatemenus:
            - buttons:
                - $fn({vars}) => vars.zoom('3 h', 3)
                - $fn({vars}) => vars.zoom('6 h', 6)
                - $fn({vars}) => vars.zoom('12 h', 12)
                - $fn({vars}) => vars.zoom('24 h', 24)
                - $fn({vars}) => vars.zoom('2 D', 24 * 2)
                - $fn({vars}) => vars.scroll('<', -0.9)
                - $fn({vars}) => vars.scroll('>', 0.9)
              direction: left
              pad:
                r: 10
                t: 10
              showactive: true
              type: buttons
              x: 1
              xanchor: right
              'y': 1.2
              yanchor: top
          legend:
            bgcolor: rgba(0,0,0,0)
            itemsizing: constant
            font:
              size: 11
          yaxis2:
            range:
              - 20
              - 105
            fixedrange: true
          yaxis:
            tickmode: 200
            dtick: null
        config:
          scrollZoom: false
      - type: custom:plotly-graph
        view_layout:
          grid-area: graph
        entities:
          - entity: sensor.battery_power
            fill: tozeroy
            name: |
              $fn ({ ys,meta }) =>
                "Battery" + "🔋" + "(" +ys[ys.length - 1]+"W)"
            line:
              color: rgb(243, 179, 202)
          - entity: sensor.battery_state_of_charge
            name: |
              $fn ({ ys,meta }) =>
                "SOC" + "⚠️" + "(" +ys[ys.length - 1]+"%)"
            yaxis: y2
            line:
              color: red
              width: 1
              shape: spline
            fill: none
            filters:
              - sliding_window_moving_average:
                  window_size: 1
                  extended: true
        hours_to_show: 24
        refresh_interval: 60
        title: Battery
        defaults:
          entity:
            show_value: false
          yaxes:
            fixedrange: true
        fn: |
          $fn({getFromConfig, vars})=> {
            const range = getFromConfig("visible_range");
            const width = range[1] - range[0];
            vars.scroll = (label, p) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [range[0] + width*p, range[1] + width*p],
                  }
                }, {
                  transition: {
                    duration: 150,
                  }
                }
              ],
              label,
              method: "animate",
            })
            vars.zoom = (label, h) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [Date.now()-1000*60*60*h, Date.now()],
                  }
                }
              ],
              label,
              method: "animate",
            })
          }
        layout:
          height: 500
          updatemenus:
            - buttons:
                - $fn({vars}) => vars.zoom('3 h', 3)
                - $fn({vars}) => vars.zoom('6 h', 6)
                - $fn({vars}) => vars.zoom('12 h', 12)
                - $fn({vars}) => vars.zoom('24 h', 24)
                - $fn({vars}) => vars.zoom('2 D', 24 * 2)
                - $fn({vars}) => vars.scroll('<', -0.9)
                - $fn({vars}) => vars.scroll('>', 0.9)
              direction: left
              pad:
                r: 10
                t: 10
              showactive: true
              type: buttons
              x: 1
              xanchor: right
              'y': 1.2
              yanchor: top
          legend:
            bgcolor: rgba(0,0,0,0)
            itemsizing: constant
            font:
              size: 11
          yaxis2:
            range:
              - 20
              - 105
            fixedrange: true
          yaxis:
            tickmode: linear
            dtick: 200
        config:
          scrollZoom: false
      - type: custom:plotly-graph
        view_layout:
          grid-area: solar
        hours_to_show: 1d
        time_offset: 0h
        refresh_interval: 30
        entities:
          - entity: sensor.pv_power
            name: Solar Power
            line:
              color: rgb(255, 155, 48)
              shape: spline
              width: 1
            fill: tozeroy
            fillcolor: rgba(255, 155, 48, 0.3)
            yaxis: y1
            show_value: false
            showlegend: false
          - entity: sensor.solcast_pv_forecast_forecast_today
            line:
              color: rgb(125,125,125)
              shape: spline
            fill: tozeroy
            filters:
              - fn: |
                  ({meta}) => {
                    const xs = meta.detailedForecast.map(({ period_start }) => new Date(period_start));
                    const ys = meta.detailedForecast.map(({ pv_estimate }) => pv_estimate * 1000/1);  // Converting kWh to watts (assuming 1-hour period)
                    return { xs, ys };
                  }
            yaxis: y1
            showlegend: true
          - entity: sensor.solcast_pv_forecast_forecast_tomorrow
            line:
              color: rgb(90,90,90)
              shape: spline
            fill: tozeroy
            filters:
              - fn: |
                  ({meta}) => {
                    const xs = meta.detailedForecast.map(({ period_start }) => new Date(period_start));
                    const ys = meta.detailedForecast.map(({ pv_estimate }) => pv_estimate * 1000/1);  // Converting kWh to watts (assuming 1-hour period)
                    return { xs, ys };
                  }
            yaxis: y1
            showlegend: true
          - entity: sensor.solcast_pv_forecast_forecast_day_3
            line:
              color: rgb(50,50,50)
              shape: spline
            fill: tozeroy
            filters:
              - fn: |
                  ({meta}) => {
                    const xs = meta.detailedForecast.map(({ period_start }) => new Date(period_start));
                    const ys = meta.detailedForecast.map(({ pv_estimate }) => pv_estimate * 1000/1);  // Converting kWh to watts (assuming 1-hour period)
                    return { xs, ys };
                  }
            yaxis: y1
            showlegend: true
          - entity: ''
            name: Now
            yaxis: y3
            showlegend: false
            line:
              width: 2
              dash: dot
              color: aqua
            x: $ex [Date.now(), Date.now()]
            'y':
              - 0
              - 1
        defaults:
          yaxes:
            fixedrange: true
        layout:
          height: 410
          margin:
            t: 55
            l: 50
          showlegend: false
          legend:
            x: 0.1
            'y': -0.8
          yaxis2:
            range:
              - 20
              - 105
            fixedrange: true
          xaxis:
            range: >-
              $ex [ new Date(new Date().setHours(6, 0, 0, 0)).getTime(), new
              Date(new Date().setHours(20, 0, 0, 0)).getTime() ]
            fixedrange: false
          annotations:
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: orange'>"
                  + Number(hass.states['sensor.solcast_pv_forecast_forecast_today'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Forecast Today</span><br>"
              xref: x domain
              yref: y domain
              xanchor: center
              yanchor: center
              x: 0.06
              'y': 1.2
              showarrow: false
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: dodgerblue'>"
                  + Number(hass.states['sensor.solcast_pv_forecast_forecast_remaining_today'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Remaining</span><br>"
              xref: x domain
              yref: y domain
              xanchor: center
              yanchor: center
              x: 0.28
              'y': 1.2
              showarrow: false
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: '>"
                  + Number(hass.states['sensor.solcast_pv_forecast_forecast_tomorrow'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Forecast Tomorrow</span><br>"
              xref: x domain
              yref: y domain
              xanchor: center
              yanchor: centre
              x: 0.5
              'y': 1.2
              showarrow: false
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: white'>"
                  + Number(hass.states['sensor.solcast_pv_forecast_forecast_day_3'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Forecast Day 3</span><br>"
              xref: x domain
              yref: y domain
              xanchor: center
              yanchor: center
              x: 0.72
              'y': 1.2
              showarrow: false
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: red'>"
                  + Number(hass.states['sensor.battery_state_of_charge'].state) + "</span></span>%<br>"
                  +  "</span><span style=''>SOC</span><br>"
              xref: x domain
              yref: y domain
              xanchor: center
              yanchor: center
              x: 0.94
              'y': 1.2
              showarrow: false
        config:
          scrollZoom: false
      - type: custom:plotly-graph
        view_layout:
          position: sidebar
        title: Load Energy Sources
        entities:
          - entity: sensor.load_energy
            type: pie
            hole: 0.4
            values: |-
              $ex [
                Number(hass.states["sensor.battery_energy_out_old"].state).toFixed(2),
                Number(hass.states["sensor.simulated_grid_energy_import_meter"].state).toFixed(2),
                Number(hass.states["sensor.self_consumed_solar_energy_day"].state).toFixed(2)
              ]
            labels:
              - Battery Charge
              - Grid Offpeak
              - Self-Consumed Solar
            marker:
              colors:
                - rgb(151, 90, 182)
                - rgb(84, 144, 194)
                - rgb(255, 155, 48)
            textinfo: value+percent
        hours_to_show: 1
        refresh_interval: auto
        layout:
          height: 410
          margin:
            t: 60
          showlegend: false
          annotations:
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: rgb(255, 155, 48'>"
                  + Number(hass.states['sensor.self_consumed_solar_energy_day'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Self-Consumed Solar</span><br>"
              xref: paper
              yref: paper
              xanchor: center
              yanchor: center
              x: 0.05
              'y': 1.2
              showarrow: false
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: rgb(151, 90, 182)'>"
                  + Number(hass.states['sensor.battery_energy_out_old'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Battery</span><br>"
              xref: paper
              yref: paper
              xanchor: center
              yanchor: center
              x: 0.5
              'y': 1.2
              showarrow: false
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: rgb(84, 144, 194)'>"
                  + Number(hass.states['sensor.grid_energy_in'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Grid</span><br>"
              xref: paper
              yref: paper
              xanchor: center
              yanchor: centre
              x: 0.9
              'y': 1.2
              showarrow: false
            - text: |-
                $fn ({hass}) =>
                  "<span style='font-size: 24px;'><span style='color: rgb(84, 144, 194)'>"
                  + Number(hass.states['sensor.load_energy'].state).toFixed(1) + "</span></span>kWh<br>"
                  +  "</span><span style=''>Load</span><br>"
              xref: paper
              yref: paper
              xanchor: center
              yanchor: centre
              x: 0.5
              'y': 0.5
              showarrow: false
      - type: custom:plotly-graph
        view_layout:
          grid-area: daily
        refresh_interval: 10
        entities:
          - entity: sensor.pv_energy
            name: |
              $fn ({ ys,meta }) =>
                "Solar" + "🔆" + "(" +ys[ys.length - 1]+"kWh)"
            marker:
              color: rgb(255, 155, 48)
          - entity: sensor.load_energy
            name: |
              $fn ({ ys,meta }) =>
                "Load" + "⚡" + "(" +ys[ys.length - 1]+"kWh)"
            marker:
              color: rgb(95, 182, 173)
          - entity: sensor.grid_energy_in
            name: |
              $fn ({ ys,meta }) =>
                "Grid Import" + "💡" + "(" +ys[ys.length - 1]+"kWh)"
            marker:
              color: rgb(84, 144, 194)
          - entity: sensor.grid_energy_out_old
            name: |
              $fn ({ ys,meta }) =>
                "Grid Export" + "🔌" + "(" +ys[ys.length - 1]+"kWh)"
            marker:
              color: rgb(255, 0, 0)
          - entity: sensor.battery_energy_out_old
            name: |
              $fn ({ ys,meta }) =>
                "Battery Discharge" + "🖱️" + "(" +ys[ys.length - 1]+"kWh)"
            marker:
              color: rgb(151, 90, 182)
          - entity: sensor.battery_energy_in
            name: |
              $fn ({ ys,meta }) =>
                "Battery Charge" + "🔋" + "(" +ys[ys.length - 1]+"kWh)"
            marker:
              color: yellow
        hours_to_show: 4d
        title: Daily Production
        defaults:
          entity:
            statistic: state
            period: day
            type: bar
            texttemplate: '%{y}'
            filters:
              - filter: i>0
          yaxes:
            fixedrange: true
        fn: |
          $fn({getFromConfig, vars})=> {
            const range = getFromConfig("visible_range");
            const width = range[1] - range[0];
            vars.scroll = (label, p) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [range[0] + width*p, range[1] + width*p],
                  }
                }, {
                  transition: {
                    duration: 30000,
                  }
                }
              ],
              label,
              method: "animate",
            })
            vars.zoom = (label, h) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [Date.now()-1000*60*60*h, Date.now()],
                  }
                }
              ],
              label,
              method: "animate",
            })
          }
        layout:
          updatemenus:
            - buttons:
                - $fn({vars}) => vars.zoom( '30d', 24*30)
                - $fn({vars}) => vars.zoom( '14d', 24*14)
                - $fn({vars}) => vars.zoom( '7d', 24*7)
                - $fn({vars}) => vars.scroll( ' <', -.5)
                - $fn({vars}) => vars.scroll( ' >', .5)
              direction: null
              active: -1
              pad:
                r: 10
                t: 10
              type: buttons
              x: 1
              xanchor: auto
              'y': 1
              yanchor: auto
          legend:
            bgcolor: rgba(0,0,0,0)
            yanchor: bottom
            xanchor: left
            x: 0
            'y': 1
            font:
              size: 11
          height: 410
        config:
          displayModeBar: false
          scrollZoom: false
        time_offset: 2h
      - type: custom:flex-horseshoe-card
        view_layout:
          position: sidebar
        entities:
          - entity: sensor.load_power
            unit: W
            name: AC
          - entity: sensor.grid_voltage
            decimals: 1
            unit: V
          - entity: sensor.grid_frequency
            decimals: 2
            unit: Hz
            name: Grid
          - entity: sensor.grid_power
            decimals: 0
            unit: W
            name: Grid
          - entity: sensor.grid_energy_in
            decimals: 2
            unit: kWh
            name: Import
          - entity: sensor.load_energy
            decimals: 2
            unit: kWh
            name: Daily
        show:
          horseshoe_style: autominmax
        layout:
          hlines:
            - id: 0
              xpos: 50
              ypos: 40
              length: 70
              styles:
                - opacity: 0.2;
            - id: 0
              xpos: 50
              ypos: 60
              length: 70
              styles:
                - opacity: 0.2;
          vlines:
            - id: 0
              xpos: 50
              ypos: 50
              length: 18
              styles:
                - opacity: 0.2;
          states:
            - id: 0
              entity_index: 0
              xpos: 50
              ypos: 33
              styles:
                - font-size: 3em;
                - opacity: 0.9;
                - text-anchor: middle;
            - id: 1
              entity_index: 1
              xpos: 44
              ypos: 53
              styles:
                - font-size: 1.5em;
                - text-anchor: end;
            - id: 2
              entity_index: 2
              xpos: 55
              ypos: 53
              styles:
                - text-anchor: start;
                - font-size: 1.5em;
            - id: 3
              entity_index: 3
              xpos: 50
              ypos: 75
              styles:
                - text-anchor: middle;
                - font-size: 2em;
            - id: 4
              entity_index: 4
              xpos: 75
              ypos: 7
              styles:
                - text-anchor: start;
                - font-size: 1.2em;
            - id: 5
              entity_index: 5
              xpos: 0
              ypos: 7
              styles:
                - text-anchor: start;
                - font-size: 1.2em;
          icons:
            - id: 0
              entity_index: 1
              xpos: 30
              ypos: 52
              align: start
              size: 1
          names:
            - id: 0
              entity_index: 0
              xpos: 50
              ypos: 95
              styles:
                - font-size: 1.2em;
            - id: 1
              entity_index: 4
              xpos: 85
              ypos: 12
              styles:
                - font-size: 0.5em;
                - text-anchor: start;
            - id: 2
              entity_index: 5
              xpos: 0
              ypos: 12
              styles:
                - font-size: 0.5em;
                - text-anchor: start;
            - id: 3
              entity_index: 3
              xpos: 50
              ypos: 80
              styles:
                - font-size: 0.5em;
                - text-anchor: middle;
        horseshoe_scale:
          min: 0
          max: 8000
          width: 6
        color_stops:
          '0': '#5fb6ad'
          '2000': '#5fb6ad'
        card_mod:
          style: |
            ha-card {
              --ha-card-background: var(--card-background-color);
              color: var(--primary-color); 
            }
      - type: custom:flex-horseshoe-card
        view_layout:
          position: sidebar
        entities:
          - entity: sensor.pv_power
            decimals: 0
            unit: W
            name: Solar
          - entity: sensor.pv_power_2
            decimals: 0
            unit: W
            name: Front
          - entity: sensor.pv_power_1
            decimals: 0
            unit: W
            name: Rear
          - entity: sensor.pv_voltage_2
            decimals: 0
            unit: V
          - entity: sensor.pv_voltage_1
            decimals: 0
            unit: V
          - entity: sensor.pv_current_2
            decimals: 1
            unit: A
          - entity: sensor.pv_current_1
            decimals: 1
            unit: A
          - entity: sensor.pv_energy
            decimals: 2
            unit: kWh
            name: Daily
          - entity: sensor.solcast_pv_forecast_forecast_remaining_today
            decimals: 2
            unit: kWh
            name: Left Today
        show:
          horseshoe_style: autominmax
        layout:
          hlines:
            - id: 0
              xpos: 50
              ypos: 40
              length: 70
              styles:
                - opacity: 0.2;
          vlines:
            - id: 0
              xpos: 50
              ypos: 59
              length: 36
              styles:
                - opacity: 0.2;
          states:
            - id: 0
              entity_index: 0
              xpos: 50
              ypos: 33
              styles:
                - font-size: 3em;
                - opacity: 0.9;
            - id: 1
              entity_index: 1
              xpos: 47
              ypos: 53
              styles:
                - font-size: 1.5em;
                - text-anchor: end;
            - id: 2
              entity_index: 2
              xpos: 53
              ypos: 53
              styles:
                - text-anchor: start;
                - font-size: 1.5em;
            - id: 3
              entity_index: 3
              xpos: 46
              ypos: 63
              styles:
                - text-anchor: end;
                - font-size: 1.5em;
            - id: 4
              entity_index: 4
              xpos: 53
              ypos: 63
              styles:
                - text-anchor: start;
                - font-size: 1.5em;
            - id: 5
              entity_index: 5
              xpos: 46
              ypos: 73
              styles:
                - text-anchor: end;
                - font-size: 1.5em;
            - id: 6
              entity_index: 6
              xpos: 53
              ypos: 73
              styles:
                - text-anchor: start;
                - font-size: 1.5em;
            - id: 7
              entity_index: 7
              xpos: 0
              ypos: 7
              styles:
                - text-anchor: start;
                - font-size: 1.2em;
            - id: 8
              entity_index: 8
              xpos: 75
              ypos: 7
              styles:
                - text-anchor: start;
                - font-size: 1.2em;
          icons:
            - id: 0
              entity_index: 1
              xpos: 1
              ypos: 53
              align: start
              size: 1
            - id: 1
              entity_index: 2
              xpos: 53
              ypos: 65
              align: end
              size: 0.5
          names:
            - id: 0
              entity_index: 0
              xpos: 50
              ypos: 95
              styles:
                - font-size: 1.2em;
            - id: 1
              entity_index: 1
              xpos: 15
              ypos: 45
              styles:
                - text-anchor: start;
                - font-size: 0.5em;
            - id: 2
              entity_index: 2
              xpos: 85
              ypos: 45
              styles:
                - text-anchor: end;
                - font-size: 0.5em;
            - id: 3
              entity_index: 7
              xpos: 0
              ypos: 12
              styles:
                - text-anchor: start;
                - font-size: 0.5em;
            - id: 4
              entity_index: 8
              xpos: 80
              ypos: 12
              styles:
                - font-size: 0.5em;
                - text-anchor: start;
        horseshoe_scale:
          min: 0
          max: 7000
          width: 6
        color_stops:
          '0': orange
          '2000': orange
        card_mod:
          style: |
            ha-card {
              --ha-card-background: var(--card-background-color);
              color: var(--primary-color); 
            }
      - type: custom:plotly-graph
        view_layout:
          grid-area: m
        entities:
          - entity: sensor.pv_energy
            statistic: sum
            name: |
              $fn ({ ys,meta }) =>
                "Solar" + "🔆"
            period: month
            type: bar
            width: $fn() => 1000*60*60*130
            offset: $fn() => -1000*60*60*325
            texttemplate: '%{y}'
            filters:
              - delta
            marker:
              color: rgb(255, 155, 48)
          - entity: sensor.load_energy
            statistic: sum
            name: |
              $fn ({ ys,meta }) =>
                "Load" + "⚡"
            period: month
            type: bar
            filters:
              - delta
            width: $fn() => 1000*60*60*130
            offset: $fn() => -1000*60*60*195
            texttemplate: '%{y}'
            marker:
              color: rgb(95, 182, 173)
          - entity: sensor.grid_energy_in
            statistic: sum
            name: |
              $fn ({ ys,meta }) =>
                "Grid Import" + "💡"
            period: month
            type: bar
            texttemplate: '%{y}'
            width: $fn() => 1000*60*60*130
            filters:
              - delta
            marker:
              color: rgb(84, 144, 194)
          - entity: sensor.battery_energy_out_old
            statistic: sum
            name: |
              $fn ({ ys,meta }) =>
                "Battery Discharge" + "🔋"
            period: month
            type: bar
            width: $fn() => 1000*60*60*130
            offset: $fn() => 1000*60*60*65
            texttemplate: '%{y}'
            filters:
              - delta
            marker:
              color: rgb(151, 90, 182)
          - entity: sensor.battery_energy_in
            statistic: sum
            name: |
              $fn ({ ys,meta }) =>
                "Battery Charge" + "🔋"
            period: month
            type: bar
            width: $fn() => 1000*60*60*130
            offset: $fn() => 1000*60*60*195
            texttemplate: '%{y}'
            filters:
              - delta
            marker:
              color: yellow
          - entity: sensor.grid_energy_out_old
            statistic: sum
            name: |
              $fn ({ ys,meta }) =>
                "Grid Export" + "⚡"
            period: month
            type: bar
            texttemplate: '%{y}'
            width: $fn() => 1000*60*60*130
            offset: $fn() => 1000*60*60*0
            filters:
              - delta
            marker:
              color: rgb(100, 200, 100)
        hours_to_show: 6M
        title: Monthly Production
        refresh_interval: 600
        defaults:
          entity:
            show_value: false
          yaxes:
            fixedrange: true
        fn: |
          $fn({getFromConfig, vars})=> {
            const range = getFromConfig("visible_range");
            const width = range[1] - range[0];
            vars.scroll = (label, p) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [range[0] + width*p, range[1] + width*p],
                  }
                }, {
                  transition: {
                    duration: 150,
                  }
                }
              ],
              label,
              method: "animate",
            })
            vars.zoom = (label, h) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [Date.now()-1000*60*60*h, Date.now()],
                  }
                }
              ],
              label,
              method: "animate",
            })
          }
        layout:
          updatemenus:
            - buttons:
                - $fn({vars}) => vars.zoom('3 M', 24 * 30 *3)
                - $fn({vars}) => vars.zoom('6 M', 24 * 30 *6)
                - $fn({vars}) => vars.zoom('12 M', 24 * 30 *12)
                - $fn({vars}) => vars.zoom('24 M', 24 * 30 *24)
                - $fn({vars}) => vars.scroll('<', -0.9)
                - $fn({vars}) => vars.scroll('>', 0.9)
              direction: left
              pad:
                r: 10
                t: 10
              showactive: true
              type: buttons
              x: 1
              xanchor: right
              'y': 1.45
              yanchor: top
          legend:
            bgcolor: rgba(0,0,0,0)
            itemsizing: constant
            font:
              size: 11
          height: 410
        config:
          displayModeBar: false
          scrollZoom: false
        time_offset: 0.5M
      - type: custom:plotly-graph
        view_layout:
          grid-area: sg
        entities:
          - entity: sensor.pv_energy
            name: |
              $fn ({ ys,meta }) =>
                "Solar" + "🔆" + "(" +ys[ys.length - 1]+"kWh)"
            type: bar
            filters:
              - filter: i>0
            marker:
              color: rgb(255, 155, 48)
          - entity: sensor.grid_energy_in
            name: |
              $fn ({ ys,meta }) =>
                "Grid Import" + "💡" + "(" +ys[ys.length - 1]+"kWh)"
            type: bar
            filters:
              - filter: i>0
            marker:
              color: rgb(84, 144, 194)
          - entity: sensor.load_energy
            show_value: true
            name: |
              $fn ({ ys,meta }) =>
                "Load" + "⚡" + "(" +ys[ys.length - 1]+"kWh)"
            type: line
            line:
              color: rgb(95, 182, 173)
              width: 2
        hours_to_show: 31d
        title: null
        refresh_interval: 60
        defaults:
          entity:
            statistic: state
            period: day
            texttemplate: '%{y}'
          yaxes:
            fixedrange: true
        fn: |
          $fn({getFromConfig, vars})=> {
            const range = getFromConfig("visible_range");
            const width = range[1] - range[0];
            vars.scroll = (label, p) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [range[0] + width*p, range[1] + width*p],
                  }
                }, {
                  transition: {
                    duration: 150,
                  }
                }
              ],
              label,
              method: "animate",
            })
            vars.zoom = (label, h) => ({
              args: [
                {
                  layout: {
                    "xaxis.range": [Date.now()-1000*60*60*h, Date.now()],
                  }
                }
              ],
              label,
              method: "animate",
            })
          }
        layout:
          updatemenus:
            - buttons:
                - $fn({vars}) => vars.scroll( '<', -.5)
                - $fn({vars}) => vars.scroll( '>', .5)
              direction: right
              active: -1
              pad:
                r: 10
                t: 10
              type: buttons
              x: 1
              xanchor: right
              'y': 1.25
              yanchor: top
            - buttons:
                - $fn({vars}) => vars.zoom( '90d', 24*90)
                - $fn({vars}) => vars.zoom( '30d', 24*30)
                - $fn({vars}) => vars.zoom( '7d', 24*7)
              direction: right
              active: -1
              pad:
                r: 10
                t: 10
              type: buttons
              x: 0
              xanchor: left
              'y': 1.25
              yanchor: top
          barmode: stack
          legend:
            bgcolor: rgba(0,0,0,0)
            itemsizing: constant
            font:
              size: 11
          height: 410
        config:
          displayModeBar: false
          scrollZoom: false
      - type: custom:flex-horseshoe-card
        entities:
          - entity: sensor.battery_state_of_charge
            decimals: 0
            unit: '%'
            name: BATTERY
          - entity: sensor.battery_voltage
            decimals: 2
            unit: V
          - entity: sensor.battery_current
            decimals: 2
            unit: A
          - entity: sensor.battery_power
            decimals: 0
            unit: W
          - entity: sensor.battery_energy_out_old
            decimals: 2
            unit: kWh
            name: Discharge
          - entity: sensor.battery_energy_in
            decimals: 2
            unit: kWh
            name: Charge
        show:
          horseshoe_style: colorstopgradient
          scale_tickmarks: false
        layout:
          hlines:
            - id: 0
              xpos: 50
              ypos: 40
              length: 70
              styles:
                - opacity: 0.2;
            - id: 0
              xpos: 50
              ypos: 60
              length: 70
              styles:
                - opacity: 0.2;
          vlines:
            - id: 0
              xpos: 50
              ypos: 50
              length: 18
              styles:
                - opacity: 0.2;
          states:
            - id: 0
              entity_index: 0
              xpos: 50
              ypos: 33
              styles:
                - font-size: 2.8em;
                - opacity: 0.8;
            - id: 1
              entity_index: 1
              xpos: 44
              ypos: 53
              styles:
                - font-size: 1.5em;
                - text-anchor: end;
            - id: 2
              entity_index: 2
              xpos: 55
              ypos: 53
              styles:
                - text-anchor: start;
                - font-size: 1.5em;
            - id: 3
              entity_index: 3
              xpos: 47
              ypos: 75
              styles:
                - text-anchor: middle;
                - font-size: 2em;
            - id: 4
              entity_index: 4
              xpos: 79
              ypos: 7
              styles:
                - text-anchor: start;
                - font-size: 1.0em;
            - id: 5
              entity_index: 5
              xpos: 0
              ypos: 7
              styles:
                - text-anchor: start;
                - font-size: 1.0em;
          names:
            - id: 0
              entity_index: 0
              xpos: 50
              ypos: 95
              styles:
                - font-size: 1.2em;
            - id: 1
              entity_index: 4
              xpos: 84
              ypos: 10
              styles:
                - font-size: 0.4em;
                - text-anchor: start;
            - id: 2
              entity_index: 5
              xpos: 0
              ypos: 10
              styles:
                - font-size: 0.4em;
                - text-anchor: start;
        horseshoe_scale:
          min: 0
          max: 100
          width: 6
        color_stops:
          '0': Crimson
          '25': Orange
          '75': Yellow
          '100': Green
        card_mod:
          style: |
            ha-card {
              border-style: none;
              background: none;
              border-radius: none;
            }
        view_layout:
          position: sidebar
    type: sidebar
    icon: mdi:alarm-panel
    layout:
      max_cols: 1
  - title: Low Carbon Info
    path: low-carbon-info
    icon: mdi:molecule-co2
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: >-
              {% set t_start = ( 
              as_timestamp(states('sensor.grid_co2_uk_local_optimal_window_from'))
              - as_timestamp(now()))%} 

              {% set t_end = ( 
              as_timestamp(states('sensor.grid_co2_uk_local_optimal_window_to'))
              - as_timestamp(now())) %}


              The best 4 hour window to run energy hungry devices in the next 24
              hours is between {{
              as_timestamp(states('sensor.grid_co2_uk_local_optimal_window_from'))|
              timestamp_custom('%I:%M %p')  }} and {{
              as_timestamp(states('sensor.grid_co2_uk_local_optimal_window_to'))
              | timestamp_custom('%I:%M %p')  }}.

              Starting in {{ t_start | timestamp_custom('%-H hr %-M min' if
              t_start > 3600 else '%-M min', false) }} and finishing {{ t_end |
              timestamp_custom('%-H hr %-M min' if t_end > 3600 else '%-M min',
              false) }} from now.
            title: Energy Usage Guide
          - type: custom:apexcharts-card
            experimental:
              color_threshold: true
            graph_span: 2d
            header:
              show: true
              title: Local Electricity Grid Carbon Intensity and Optimal Windows
            span:
              start: minute
            update_interval: 1min
            series:
              - entity: sensor.grid_co2_uk_local_co2_intensity_forecast_48h
                unit: g/kWh
                name: Carbon Intensity g/kWh
                show:
                  legend_value: false
                data_generator: |
                  return entity.attributes.forecast.map(obj => {
                    return [new Date(obj.from).getTime(), obj.intensity];
                  });
                color_threshold:
                  - value: 25
                    color: darkgreen
                    opacity: 1
                  - value: 95
                    color: green
                  - value: 180
                    color: gold
                  - value: 279
                    color: red
                  - value: 330
                    color: darkred
              - entity: sensor.grid_co2_uk_local_co2_intensity_forecast_48h
                type: area
                unit: g/kWh
                color: green
                name: Optimal Window
                stroke_width: 0
                show:
                  legend_value: false
                data_generator: |
                  return entity.attributes.forecast.map(obj => {
                    return [new Date(obj.from).getTime(), (obj.optimal ? obj.intensity : 0 )];
                  });
          - type: gauge
            entity: sensor.grid_co2_uk_local_grid_low_carbon
            segments:
              - from: 0
                color: '#db4437'
              - from: 35
                color: '#ffa600'
              - from: 65
                color: '#43a047'
          - type: gauge
            entity: sensor.grid_co2_uk_local_grid_fossil_fuel
            needle: false
            severity:
              green: 20
              yellow: 40
              red: 50
      - type: vertical-stack
        cards:
          - type: custom:html-template-card
            title: Energy Intensity Forecast
            ignore_line_breaks: true
            content: >
              <style> table {    width: 100%;   } tr:nth-child(even) {    
              background-color:
              [#222222](https://github.com/alanmcgore/sensor.carbon_intensity_uk/issues/222222);  
              } td, th {     text-align: left;   } </style>  <table> <thead>
              <tr> <th>Period</th> <th>Index</th>  <th>Intensity</th>
              </tr></thead> <tbody>  {% for state in  
              states.sensor.grid_co2_uk_local_co2_intensity_forecast_48h.attributes.forecast
              -%}  <tr {% if state.optimal %} 
              style="background-color:[#336600](https://github.com/alanmcgore/sensor.carbon_intensity_uk/issues/336600);"{%endif%}>
                <td> {{ as_timestamp(state.from) | timestamp_custom('%I:%M %p') }} - {{ as_timestamp(state.to) | timestamp_custom('%I:%M %p')}}</td>
                <td {% if state.index=='high' or state.index=='very high' %} style="color:#cc3300"{%endif%}
                {% if state.index=='moderate' %} style="color:#ff9900"{%endif%} >  {{state.index}}</td>
                <td {% if state.index=='high' or state.index=='very high' %} style="color:#cc3300"{%endif%}
                {% if state.index=='moderate' %} style="color:#ff9900"{%endif%} >  {{state.intensity}}</td>
              </tr>  {%- endfor %}   </tbody> </table> 
      - type: vertical-stack
        cards:
          - type: history-graph
            entities:
              - entity: sensor.grid_co2_uk_local_grid_co2_levels
              - entity: sensor.grid_co2_uk_local_grid_co2_intensity
              - entity: sensor.grid_co2_uk_local_grid_fossil_fuel
              - entity: sensor.grid_co2_uk_local_grid_low_carbon
            title: Local Grid CO2 Intensity
      - type: logbook
        entities:
          - sensor.grid_co2_uk_local_grid_co2_levels
      - type: custom:mushroom-entity-card
        entity: sensor.lanyard_mini_hygrometer_0cab_temperature
        name: Back to Dasboard
        fill_container: true
        icon_type: none
        layout: vertical
        secondary_info: none
        tap_action:
          action: navigate
          navigation_path: /dashboard-tablet2
        card_mod:
          style: |
            ha-card {
              --card-secondary-color: darkorange;
              --card-secondary-font-weight: bold;
              --card-secondary-font-size: 20px;
              --card-primary-font-size: 15px;
            }
        view_layout:
          position: sidebar
      - type: custom:mushroom-entity-card
        entity: sensor.lanyard_mini_hygrometer_0cab_temperature
        name: Back to Main Page
        fill_container: true
        icon_type: none
        layout: vertical
        secondary_info: none
        tap_action:
          action: navigate
          navigation_path: /lovelace
        card_mod:
          style: |
            ha-card {
              --card-secondary-color: darkorange;
              --card-secondary-font-weight: bold;
              --card-secondary-font-size: 20px;
              --card-primary-font-size: 15px;
            }
        view_layout:
          position: sidebar
    type: custom:horizontal-layout
  - icon: mdi:weather-partly-snowy-rainy
    path: weather-tablet
    title: Weather_tablet
    cards:
      - type: iframe
        url: >-
          https://embed.windy.com/embed.html?type=map&location=coordinates&metricRain=mm&metricTemp=°C&metricWind=mph&zoom=9&overlay=rain&product=ecmwf&level=surface&lat=53.26&lon=-2.365&detailLat=53.408&detailLon=-2.16&detail=true&pressure=true&message=true"
          frameborder="0"></iframe>
        aspect_ratio: 100%
    badges:
      - type: entity
        entity: sensor.downstairs_hvac_action
        tap_action:
          action: navigate
          navigation_path: /dashboard-tablet2
    type: panel
